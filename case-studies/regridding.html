
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Regridding with xesmf &#8212; Parallel Programming in Climate and Weather</title>
    
  <link href="../_static/css/theme.css" rel="stylesheet" />
  <link href="../_static/css/index.c5995385ac14fb8791e8eb36b4908be2.css" rel="stylesheet" />

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/sphinx-book-theme.acff12b8f9c144ce68a297486a2fa670.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="../_static/js/index.1c5a1a01449ed65a7b51.js">

    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/togglebutton.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../_static/sphinx-book-theme.12a9622fbb08dcb3a2a40b2c02b83a57.js"></script>
    <script async="async" src="https://unpkg.com/thebelab@latest/lib/index.js"></script>
    <script >
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="prev" title="Monthly Climatology of Many Variables" href="climatology_multivar.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../index.html">
      
      
      <h1 class="site-logo" id="site-title">Parallel Programming in Climate and Weather</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
    <div class="bd-toc-item active">
        <ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../README.html">
   Front Matter
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Concepts
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../concepts-intro.html">
   Introduction
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../concepts-types.html">
   Types of parallelism
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../design-patterns.html">
   Design Patterns
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Dask
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../dask-intro.html">
   Introduction
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../dask-performance.html">
   Performance
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../dask-troubleshooting.html">
   Pathological Behaviour and Troubleshooting
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="read_speed.html">
   Measuring Performance
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../dask-batch.html">
   Batch Scripts
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Case Studies
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="oned_to_nd.html">
   Converting a function from 1D to ND
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="loading_ensemble.html">
   Loading Ensemble Members
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="climatology_multivar.html">
   Monthly Climatology of Many Variables
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   Regridding with xesmf
  </a>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../_sources/case-studies/regridding.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://github.com/coecms-training/parallel"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Source repository"><i
                    class="fab fa-github"></i>repository</button></a>
        
        
    </div>
</div>

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/coecms-training/parallel/master?urlpath=tree/case-studies/regridding.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="../_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        
    </div>
</div>

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show">
            
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="section" id="regridding-with-xesmf">
<h1>Regridding with xesmf<a class="headerlink" href="#regridding-with-xesmf" title="Permalink to this headline">¶</a></h1>
<p>The <a class="reference external" href="https://pangeo-xesmf.readthedocs.io">xesmf</a> library is a dask-aware regridding library, based on the Earth System Modelling Framework’s regridder.</p>
<p>Let’s use it to compare CMIP6 results with ERA5. These datasets are on different grids, so we need to regrid to compare them.</p>
<p>We can regrid in either direction, but always keep in mind that regridding never creates new information when you go from a coarse to fine resolution.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">xarray</span>
<span class="kn">import</span> <span class="nn">xesmf</span>
<span class="kn">import</span> <span class="nn">intake</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">dask.distributed</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dask</span><span class="o">.</span><span class="n">distributed</span><span class="o">.</span><span class="n">Client</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table style="border: 2px solid white;">
<tr>
<td style="vertical-align: top; border: 0px solid white">
<h3 style="text-align: left;">Client</h3>
<ul style="text-align: left; list-style: none; margin: 0; padding: 0;">
  <li><b>Scheduler: </b>tcp://127.0.0.1:44561</li>
  <li><b>Dashboard: </b><a href='http://127.0.0.1:8787/status' target='_blank'>http://127.0.0.1:8787/status</a></li>
</ul>
</td>
<td style="vertical-align: top; border: 0px solid white">
<h3 style="text-align: left;">Cluster</h3>
<ul style="text-align: left; list-style:none; margin: 0; padding: 0;">
  <li><b>Workers: </b>4</li>
  <li><b>Cores: </b>4</li>
  <li><b>Memory: </b>7.86 GB</li>
</ul>
</td>
</tr>
</table></div></div>
</div>
<p>To start out we’ll load the data from the intake catalogue</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dsd</span> <span class="o">=</span> <span class="p">(</span><span class="n">intake</span><span class="o">.</span><span class="n">cat</span><span class="o">.</span><span class="n">nci</span><span class="o">.</span><span class="n">esgf</span><span class="o">.</span><span class="n">cmip6</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">source_id</span><span class="o">=</span><span class="s1">&#39;ACCESS-CM2&#39;</span><span class="p">,</span> <span class="n">experiment_id</span><span class="o">=</span><span class="s1">&#39;historical&#39;</span><span class="p">,</span> <span class="n">variable_id</span><span class="o">=</span><span class="s1">&#39;tas&#39;</span><span class="p">,</span> <span class="n">member_id</span><span class="o">=</span><span class="s1">&#39;r1i1p1f1&#39;</span><span class="p">,</span> <span class="n">table_id</span><span class="o">=</span><span class="s1">&#39;Amon&#39;</span><span class="p">)</span>
       <span class="o">.</span><span class="n">to_dataset_dict</span><span class="p">(</span><span class="n">cdf_kwargs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;chunks&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;time&#39;</span><span class="p">:</span> <span class="mi">120</span><span class="p">}}))</span>
<span class="n">ds_cmip</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">dsd</span><span class="o">.</span><span class="n">values</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>--&gt; The keys in the returned dictionary of datasets are constructed as follows:
	&#39;project.activity_id.institution_id.source_id.experiment_id.member_id.table_id.variable_id.grid_label.version&#39;
</pre></div>
</div>
<div class="output text_html">
<div>
    <style>
        /* Turns off some styling */
        progress {
            /* gets rid of default border in Firefox and Opera. */
            border: none;
            /* Needs to be in here for Safari polyfill so background images work as expected. */
            background-size: auto;
        }
        .progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {
            background: #F44336;
        }
    </style>
  <progress value='1' class='' max='1' style='width:300px; height:20px; vertical-align: middle;'></progress>
  100.00% [1/1 00:00<00:00]
</div>
</div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dsd</span> <span class="o">=</span> <span class="p">(</span><span class="n">intake</span><span class="o">.</span><span class="n">cat</span><span class="o">.</span><span class="n">nci</span><span class="o">.</span><span class="n">era5</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">product_type</span><span class="o">=</span><span class="s1">&#39;reanalysis&#39;</span><span class="p">,</span> <span class="n">year</span><span class="o">=</span><span class="mi">2010</span><span class="p">,</span> <span class="n">parameter</span><span class="o">=</span><span class="s1">&#39;2t&#39;</span><span class="p">)</span>
       <span class="o">.</span><span class="n">to_dataset_dict</span><span class="p">(</span><span class="n">cdf_kwargs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;chunks&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;time&#39;</span><span class="p">:</span> <span class="mi">24</span><span class="p">,</span> <span class="s1">&#39;latitude&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;longitude&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">}}))</span>
<span class="n">ds_era5</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">dsd</span><span class="o">.</span><span class="n">values</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>--&gt; The keys in the returned dictionary of datasets are constructed as follows:
	&#39;sub_collection.dataset.product_type&#39;
</pre></div>
</div>
<div class="output text_html">
<div>
    <style>
        /* Turns off some styling */
        progress {
            /* gets rid of default border in Firefox and Opera. */
            border: none;
            /* Needs to be in here for Safari polyfill so background images work as expected. */
            background-size: auto;
        }
        .progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {
            background: #F44336;
        }
    </style>
  <progress value='1' class='' max='1' style='width:300px; height:20px; vertical-align: middle;'></progress>
  100.00% [1/1 00:00<00:00]
</div>
</div></div>
</div>
<p>I’ve chosen the chunk sizes here to be the whole grid in the lat and lon dimensions and small in the time dimension, keeping the chunk size under 100 mb. The regridder runs on the whole horizontal plane at once, so there can’t be any chunking in lat or lon</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ds_cmip</span><span class="o">.</span><span class="n">tas</span><span class="o">.</span><span class="n">data</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table>
<tr>
<td>
<table>
  <thead>
    <tr><td> </td><th> Array </th><th> Chunk </th></tr>
  </thead>
  <tbody>
    <tr><th> Bytes </th><td> 218.97 MB </td> <td> 13.27 MB </td></tr>
    <tr><th> Shape </th><td> (1980, 144, 192) </td> <td> (120, 144, 192) </td></tr>
    <tr><th> Count </th><td> 18 Tasks </td><td> 17 Chunks </td></tr>
    <tr><th> Type </th><td> float32 </td><td> numpy.ndarray </td></tr>
  </tbody>
</table>
</td>
<td>
<svg width="169" height="157" style="stroke:rgb(0,0,0);stroke-width:1" >

  <!-- Horizontal lines -->
  <line x1="10" y1="0" x2="80" y2="70" style="stroke-width:2" />
  <line x1="10" y1="36" x2="80" y2="107" style="stroke-width:2" />

  <!-- Vertical lines -->
  <line x1="10" y1="0" x2="10" y2="36" style="stroke-width:2" />
  <line x1="14" y1="4" x2="14" y2="41" />
  <line x1="18" y1="8" x2="18" y2="45" />
  <line x1="22" y1="12" x2="22" y2="49" />
  <line x1="27" y1="17" x2="27" y2="53" />
  <line x1="31" y1="21" x2="31" y2="58" />
  <line x1="35" y1="25" x2="35" y2="62" />
  <line x1="39" y1="29" x2="39" y2="66" />
  <line x1="44" y1="34" x2="44" y2="70" />
  <line x1="48" y1="38" x2="48" y2="75" />
  <line x1="52" y1="42" x2="52" y2="79" />
  <line x1="57" y1="47" x2="57" y2="83" />
  <line x1="61" y1="51" x2="61" y2="88" />
  <line x1="65" y1="55" x2="65" y2="92" />
  <line x1="69" y1="59" x2="69" y2="96" />
  <line x1="74" y1="64" x2="74" y2="100" />
  <line x1="78" y1="68" x2="78" y2="105" />
  <line x1="80" y1="70" x2="80" y2="107" style="stroke-width:2" />

  <!-- Colored Rectangle -->
  <polygon points="10.0,0.0 80.58823529411765,70.58823529411765 80.58823529411765,107.35463992729706 10.0,36.76640463317941" style="fill:#ECB172A0;stroke-width:0"/>

  <!-- Horizontal lines -->
  <line x1="10" y1="0" x2="48" y2="0" style="stroke-width:2" />
  <line x1="14" y1="4" x2="52" y2="4" />
  <line x1="18" y1="8" x2="56" y2="8" />
  <line x1="22" y1="12" x2="61" y2="12" />
  <line x1="27" y1="17" x2="65" y2="17" />
  <line x1="31" y1="21" x2="69" y2="21" />
  <line x1="35" y1="25" x2="74" y2="25" />
  <line x1="39" y1="29" x2="78" y2="29" />
  <line x1="44" y1="34" x2="82" y2="34" />
  <line x1="48" y1="38" x2="86" y2="38" />
  <line x1="52" y1="42" x2="91" y2="42" />
  <line x1="57" y1="47" x2="95" y2="47" />
  <line x1="61" y1="51" x2="99" y2="51" />
  <line x1="65" y1="55" x2="104" y2="55" />
  <line x1="69" y1="59" x2="108" y2="59" />
  <line x1="74" y1="64" x2="112" y2="64" />
  <line x1="78" y1="68" x2="116" y2="68" />
  <line x1="80" y1="70" x2="119" y2="70" style="stroke-width:2" />

  <!-- Vertical lines -->
  <line x1="10" y1="0" x2="80" y2="70" style="stroke-width:2" />
  <line x1="48" y1="0" x2="119" y2="70" style="stroke-width:2" />

  <!-- Colored Rectangle -->
  <polygon points="10.0,0.0 48.42563224869931,0.0 119.01386754281697,70.58823529411765 80.58823529411765,70.58823529411765" style="fill:#ECB172A0;stroke-width:0"/>

  <!-- Horizontal lines -->
  <line x1="80" y1="70" x2="119" y2="70" style="stroke-width:2" />
  <line x1="80" y1="107" x2="119" y2="107" style="stroke-width:2" />

  <!-- Vertical lines -->
  <line x1="80" y1="70" x2="80" y2="107" style="stroke-width:2" />
  <line x1="119" y1="70" x2="119" y2="107" style="stroke-width:2" />

  <!-- Colored Rectangle -->
  <polygon points="80.58823529411765,70.58823529411765 119.01386754281697,70.58823529411765 119.01386754281697,107.35463992729706 80.58823529411765,107.35463992729706" style="fill:#ECB172A0;stroke-width:0"/>

  <!-- Text -->
  <text x="99.801051" y="127.354640" font-size="1.0rem" font-weight="100" text-anchor="middle" >192</text>
  <text x="139.013868" y="88.971438" font-size="1.0rem" font-weight="100" text-anchor="middle" transform="rotate(-90,139.013868,88.971438)">144</text>
  <text x="35.294118" y="92.060522" font-size="1.0rem" font-weight="100" text-anchor="middle" transform="rotate(45,35.294118,92.060522)">1980</text>
</svg>
</td>
</tr>
</table></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ds_era5</span><span class="o">.</span><span class="n">t2m</span><span class="o">.</span><span class="n">data</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table>
<tr>
<td>
<table>
  <thead>
    <tr><td> </td><th> Array </th><th> Chunk </th></tr>
  </thead>
  <tbody>
    <tr><th> Bytes </th><td> 36.38 GB </td> <td> 99.67 MB </td></tr>
    <tr><th> Shape </th><td> (8760, 721, 1440) </td> <td> (24, 721, 1440) </td></tr>
    <tr><th> Count </th><td> 742 Tasks </td><td> 365 Chunks </td></tr>
    <tr><th> Type </th><td> float32 </td><td> numpy.ndarray </td></tr>
  </tbody>
</table>
</td>
<td>
<svg width="171" height="158" style="stroke:rgb(0,0,0);stroke-width:1" >

  <!-- Horizontal lines -->
  <line x1="10" y1="0" x2="80" y2="70" style="stroke-width:2" />
  <line x1="10" y1="37" x2="80" y2="108" style="stroke-width:2" />

  <!-- Vertical lines -->
  <line x1="10" y1="0" x2="10" y2="37" style="stroke-width:2" />
  <line x1="13" y1="3" x2="13" y2="41" />
  <line x1="17" y1="7" x2="17" y2="44" />
  <line x1="21" y1="11" x2="21" y2="48" />
  <line x1="24" y1="14" x2="24" y2="52" />
  <line x1="28" y1="18" x2="28" y2="56" />
  <line x1="32" y1="22" x2="32" y2="59" />
  <line x1="35" y1="25" x2="35" y2="63" />
  <line x1="39" y1="29" x2="39" y2="67" />
  <line x1="43" y1="33" x2="43" y2="70" />
  <line x1="47" y1="37" x2="47" y2="74" />
  <line x1="50" y1="40" x2="50" y2="78" />
  <line x1="54" y1="44" x2="54" y2="81" />
  <line x1="58" y1="48" x2="58" y2="85" />
  <line x1="61" y1="51" x2="61" y2="89" />
  <line x1="65" y1="55" x2="65" y2="93" />
  <line x1="69" y1="59" x2="69" y2="96" />
  <line x1="73" y1="63" x2="73" y2="100" />
  <line x1="76" y1="66" x2="76" y2="104" />
  <line x1="80" y1="70" x2="80" y2="108" style="stroke-width:2" />

  <!-- Colored Rectangle -->
  <polygon points="10.0,0.0 80.58823529411765,70.58823529411765 80.58823529411765,108.07999437241787 10.0,37.49175907830022" style="fill:#8B4903A0;stroke-width:0"/>

  <!-- Horizontal lines -->
  <line x1="10" y1="0" x2="51" y2="0" style="stroke-width:2" />
  <line x1="13" y1="3" x2="54" y2="3" />
  <line x1="17" y1="7" x2="58" y2="7" />
  <line x1="21" y1="11" x2="62" y2="11" />
  <line x1="24" y1="14" x2="65" y2="14" />
  <line x1="28" y1="18" x2="69" y2="18" />
  <line x1="32" y1="22" x2="73" y2="22" />
  <line x1="35" y1="25" x2="77" y2="25" />
  <line x1="39" y1="29" x2="80" y2="29" />
  <line x1="43" y1="33" x2="84" y2="33" />
  <line x1="47" y1="37" x2="88" y2="37" />
  <line x1="50" y1="40" x2="91" y2="40" />
  <line x1="54" y1="44" x2="95" y2="44" />
  <line x1="58" y1="48" x2="99" y2="48" />
  <line x1="61" y1="51" x2="102" y2="51" />
  <line x1="65" y1="55" x2="106" y2="55" />
  <line x1="69" y1="59" x2="110" y2="59" />
  <line x1="73" y1="63" x2="114" y2="63" />
  <line x1="76" y1="66" x2="117" y2="66" />
  <line x1="80" y1="70" x2="121" y2="70" style="stroke-width:2" />

  <!-- Vertical lines -->
  <line x1="10" y1="0" x2="80" y2="70" style="stroke-width:2" />
  <line x1="51" y1="0" x2="121" y2="70" style="stroke-width:2" />

  <!-- Colored Rectangle -->
  <polygon points="10.0,0.0 51.13999720598501,0.0 121.72823250010266,70.58823529411765 80.58823529411765,70.58823529411765" style="fill:#8B4903A0;stroke-width:0"/>

  <!-- Horizontal lines -->
  <line x1="80" y1="70" x2="121" y2="70" style="stroke-width:2" />
  <line x1="80" y1="108" x2="121" y2="108" style="stroke-width:2" />

  <!-- Vertical lines -->
  <line x1="80" y1="70" x2="80" y2="108" style="stroke-width:2" />
  <line x1="121" y1="70" x2="121" y2="108" style="stroke-width:2" />

  <!-- Colored Rectangle -->
  <polygon points="80.58823529411765,70.58823529411765 121.72823250010266,70.58823529411765 121.72823250010266,108.07999437241787 80.58823529411765,108.07999437241787" style="fill:#ECB172A0;stroke-width:0"/>

  <!-- Text -->
  <text x="101.158234" y="128.079994" font-size="1.0rem" font-weight="100" text-anchor="middle" >1440</text>
  <text x="141.728233" y="89.334115" font-size="1.0rem" font-weight="100" text-anchor="middle" transform="rotate(-90,141.728233,89.334115)">721</text>
  <text x="35.294118" y="92.785877" font-size="1.0rem" font-weight="100" text-anchor="middle" transform="rotate(45,35.294118,92.785877)">8760</text>
</svg>
</td>
</tr>
</table></div></div>
</div>
<p>Using the xesmf regridder is simple, we just supply datasets for the source and target grids. Xesmf will automatically find the latitude and longitude dimensions, plus the bounds coordinates if available.</p>
<p>Since I’m just plotting the data I’ve chosen a bilinear regridding method. The options here are:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">'bilinear'</span></code>: Bilinear interpolation</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">'patch'</span></code>: Smooth interpolation</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">'nearest_s2d'</span></code>: Each destination point gets the nearest source point (nearest grid point interpolation)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">'nearest_d2s'</span></code>: Each source point goes to its nearest destination point (only once, so there will be gaps if going from a coarse to fine resolution)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">'conservative_normed'</span></code>: Retains the global sum before and after regridding, handles coastlines if masked</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">'conservative'</span></code>: Retains the global sum before and after regridding, may have artefacts along the coastline if masked</p></li>
</ul>
<p>The conservative methods are useful in coupled models where you want to conserve the quantities being regridded. Bilinear and patch are good for visualisation. See <a class="reference external" href="https://pangeo-xesmf.readthedocs.io/en/latest/notebooks/Compare_algorithms.html">https://pangeo-xesmf.readthedocs.io/en/latest/notebooks/Compare_algorithms.html</a> for samples of each algorithm.</p>
<p>If your data is masked so that it only has valid data over certain areas (e.g. the land or ocean) you can tell xesmf this by adding a ‘mask’ variable to your dataset that is 1 in the valid areas and 0 for the grid points to ignore. A simple way to do this is</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">ds</span><span class="p">[</span><span class="s1">&#39;mask&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">xarray</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">var</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
<p>Sometimes the masks of the two datasets don’t perfectly align. In this case you can add <code class="docutils literal notranslate"><span class="pre">extrap_method</span></code> to the <code class="docutils literal notranslate"><span class="pre">Regridder()</span></code> arguments, which can be</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">'inverse_dist'</span></code>: Extrapolated points are the mean of nearby points, inversely weighted by distance</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">'nearest_s2d'</span></code>: Extrapolated points are from their nearest unmasked source grid point</p></li>
</ul>
<p>There are additional arguments that can be used if desired to set up the <code class="docutils literal notranslate"><span class="pre">inverse_dist</span></code> extrapolation, but generally the defaults are fine.</p>
<p>Finally, if you have a global grid let xesmf know by saying <code class="docutils literal notranslate"><span class="pre">periodic=True</span></code>, otherwise the edges of the grid won’t line up with each other.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">regrid_cmip_to_era5</span> <span class="o">=</span> <span class="n">xesmf</span><span class="o">.</span><span class="n">Regridder</span><span class="p">(</span><span class="n">ds_cmip</span><span class="p">,</span> <span class="n">ds_era5</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;bilinear&#39;</span><span class="p">,</span> <span class="n">periodic</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>The regridding is Dask-aware, so you can give it a large dataset and it will only compute the time-slices you actually use when you make a plot or save the result to a file</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tas</span> <span class="o">=</span> <span class="n">regrid_cmip_to_era5</span><span class="p">(</span><span class="n">ds_cmip</span><span class="o">.</span><span class="n">tas</span><span class="p">)</span>
<span class="n">tas</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/g/data3/hh5/public/apps/miniconda3/envs/analysis3-21.01/lib/python3.8/site-packages/xesmf/frontend.py:464: FutureWarning: ``output_sizes`` should be given in the ``dask_gufunc_kwargs`` parameter. It will be removed as direct parameter in a future version.
  dr_out = xr.apply_ufunc(
</pre></div>
</div>
<div class="output text_html"><div><svg style="position: absolute; width: 0; height: 0; overflow: hidden">
<defs>
<symbol id="icon-database" viewBox="0 0 32 32">
<path d="M16 0c-8.837 0-16 2.239-16 5v4c0 2.761 7.163 5 16 5s16-2.239 16-5v-4c0-2.761-7.163-5-16-5z"></path>
<path d="M16 17c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
<path d="M16 26c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
</symbol>
<symbol id="icon-file-text2" viewBox="0 0 32 32">
<path d="M28.681 7.159c-0.694-0.947-1.662-2.053-2.724-3.116s-2.169-2.030-3.116-2.724c-1.612-1.182-2.393-1.319-2.841-1.319h-15.5c-1.378 0-2.5 1.121-2.5 2.5v27c0 1.378 1.122 2.5 2.5 2.5h23c1.378 0 2.5-1.122 2.5-2.5v-19.5c0-0.448-0.137-1.23-1.319-2.841zM24.543 5.457c0.959 0.959 1.712 1.825 2.268 2.543h-4.811v-4.811c0.718 0.556 1.584 1.309 2.543 2.268zM28 29.5c0 0.271-0.229 0.5-0.5 0.5h-23c-0.271 0-0.5-0.229-0.5-0.5v-27c0-0.271 0.229-0.5 0.5-0.5 0 0 15.499-0 15.5 0v7c0 0.552 0.448 1 1 1h7v19.5z"></path>
<path d="M23 26h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
<path d="M23 22h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
<path d="M23 18h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
</symbol>
</defs>
</svg>
<style>/* CSS stylesheet for displaying xarray objects in jupyterlab.
 *
 */

:root {
  --xr-font-color0: var(--jp-content-font-color0, rgba(0, 0, 0, 1));
  --xr-font-color2: var(--jp-content-font-color2, rgba(0, 0, 0, 0.54));
  --xr-font-color3: var(--jp-content-font-color3, rgba(0, 0, 0, 0.38));
  --xr-border-color: var(--jp-border-color2, #e0e0e0);
  --xr-disabled-color: var(--jp-layout-color3, #bdbdbd);
  --xr-background-color: var(--jp-layout-color0, white);
  --xr-background-color-row-even: var(--jp-layout-color1, white);
  --xr-background-color-row-odd: var(--jp-layout-color2, #eeeeee);
}

html[theme=dark],
body.vscode-dark {
  --xr-font-color0: rgba(255, 255, 255, 1);
  --xr-font-color2: rgba(255, 255, 255, 0.54);
  --xr-font-color3: rgba(255, 255, 255, 0.38);
  --xr-border-color: #1F1F1F;
  --xr-disabled-color: #515151;
  --xr-background-color: #111111;
  --xr-background-color-row-even: #111111;
  --xr-background-color-row-odd: #313131;
}

.xr-wrap {
  display: block;
  min-width: 300px;
  max-width: 700px;
}

.xr-text-repr-fallback {
  /* fallback to plain text repr when CSS is not injected (untrusted notebook) */
  display: none;
}

.xr-header {
  padding-top: 6px;
  padding-bottom: 6px;
  margin-bottom: 4px;
  border-bottom: solid 1px var(--xr-border-color);
}

.xr-header > div,
.xr-header > ul {
  display: inline;
  margin-top: 0;
  margin-bottom: 0;
}

.xr-obj-type,
.xr-array-name {
  margin-left: 2px;
  margin-right: 10px;
}

.xr-obj-type {
  color: var(--xr-font-color2);
}

.xr-sections {
  padding-left: 0 !important;
  display: grid;
  grid-template-columns: 150px auto auto 1fr 20px 20px;
}

.xr-section-item {
  display: contents;
}

.xr-section-item input {
  display: none;
}

.xr-section-item input + label {
  color: var(--xr-disabled-color);
}

.xr-section-item input:enabled + label {
  cursor: pointer;
  color: var(--xr-font-color2);
}

.xr-section-item input:enabled + label:hover {
  color: var(--xr-font-color0);
}

.xr-section-summary {
  grid-column: 1;
  color: var(--xr-font-color2);
  font-weight: 500;
}

.xr-section-summary > span {
  display: inline-block;
  padding-left: 0.5em;
}

.xr-section-summary-in:disabled + label {
  color: var(--xr-font-color2);
}

.xr-section-summary-in + label:before {
  display: inline-block;
  content: '►';
  font-size: 11px;
  width: 15px;
  text-align: center;
}

.xr-section-summary-in:disabled + label:before {
  color: var(--xr-disabled-color);
}

.xr-section-summary-in:checked + label:before {
  content: '▼';
}

.xr-section-summary-in:checked + label > span {
  display: none;
}

.xr-section-summary,
.xr-section-inline-details {
  padding-top: 4px;
  padding-bottom: 4px;
}

.xr-section-inline-details {
  grid-column: 2 / -1;
}

.xr-section-details {
  display: none;
  grid-column: 1 / -1;
  margin-bottom: 5px;
}

.xr-section-summary-in:checked ~ .xr-section-details {
  display: contents;
}

.xr-array-wrap {
  grid-column: 1 / -1;
  display: grid;
  grid-template-columns: 20px auto;
}

.xr-array-wrap > label {
  grid-column: 1;
  vertical-align: top;
}

.xr-preview {
  color: var(--xr-font-color3);
}

.xr-array-preview,
.xr-array-data {
  padding: 0 5px !important;
  grid-column: 2;
}

.xr-array-data,
.xr-array-in:checked ~ .xr-array-preview {
  display: none;
}

.xr-array-in:checked ~ .xr-array-data,
.xr-array-preview {
  display: inline-block;
}

.xr-dim-list {
  display: inline-block !important;
  list-style: none;
  padding: 0 !important;
  margin: 0;
}

.xr-dim-list li {
  display: inline-block;
  padding: 0;
  margin: 0;
}

.xr-dim-list:before {
  content: '(';
}

.xr-dim-list:after {
  content: ')';
}

.xr-dim-list li:not(:last-child):after {
  content: ',';
  padding-right: 5px;
}

.xr-has-index {
  font-weight: bold;
}

.xr-var-list,
.xr-var-item {
  display: contents;
}

.xr-var-item > div,
.xr-var-item label,
.xr-var-item > .xr-var-name span {
  background-color: var(--xr-background-color-row-even);
  margin-bottom: 0;
}

.xr-var-item > .xr-var-name:hover span {
  padding-right: 5px;
}

.xr-var-list > li:nth-child(odd) > div,
.xr-var-list > li:nth-child(odd) > label,
.xr-var-list > li:nth-child(odd) > .xr-var-name span {
  background-color: var(--xr-background-color-row-odd);
}

.xr-var-name {
  grid-column: 1;
}

.xr-var-dims {
  grid-column: 2;
}

.xr-var-dtype {
  grid-column: 3;
  text-align: right;
  color: var(--xr-font-color2);
}

.xr-var-preview {
  grid-column: 4;
}

.xr-var-name,
.xr-var-dims,
.xr-var-dtype,
.xr-preview,
.xr-attrs dt {
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  padding-right: 10px;
}

.xr-var-name:hover,
.xr-var-dims:hover,
.xr-var-dtype:hover,
.xr-attrs dt:hover {
  overflow: visible;
  width: auto;
  z-index: 1;
}

.xr-var-attrs,
.xr-var-data {
  display: none;
  background-color: var(--xr-background-color) !important;
  padding-bottom: 5px !important;
}

.xr-var-attrs-in:checked ~ .xr-var-attrs,
.xr-var-data-in:checked ~ .xr-var-data {
  display: block;
}

.xr-var-data > table {
  float: right;
}

.xr-var-name span,
.xr-var-data,
.xr-attrs {
  padding-left: 25px !important;
}

.xr-attrs,
.xr-var-attrs,
.xr-var-data {
  grid-column: 1 / -1;
}

dl.xr-attrs {
  padding: 0;
  margin: 0;
  display: grid;
  grid-template-columns: 125px auto;
}

.xr-attrs dt,
.xr-attrs dd {
  padding: 0;
  margin: 0;
  float: left;
  padding-right: 10px;
  width: auto;
}

.xr-attrs dt {
  font-weight: normal;
  grid-column: 1;
}

.xr-attrs dt:hover span {
  display: inline-block;
  background: var(--xr-background-color);
  padding-right: 10px;
}

.xr-attrs dd {
  grid-column: 2;
  white-space: pre-wrap;
  word-break: break-all;
}

.xr-icon-database,
.xr-icon-file-text2 {
  display: inline-block;
  vertical-align: middle;
  width: 1em;
  height: 1.5em !important;
  stroke-width: 0;
  stroke: currentColor;
  fill: currentColor;
}
</style><pre class='xr-text-repr-fallback'>&lt;xarray.DataArray &#x27;tas&#x27; (time: 1980, latitude: 721, longitude: 1440)&gt;
dask.array&lt;transpose, shape=(1980, 721, 1440), dtype=float64, chunksize=(120, 721, 1440), chunktype=numpy.ndarray&gt;
Coordinates:
  * time       (time) datetime64[ns] 1850-01-16T12:00:00 ... 2014-12-16T12:00:00
    height     float64 ...
  * longitude  (longitude) float32 -180.0 -179.8 -179.5 ... 179.2 179.5 179.8
  * latitude   (latitude) float32 90.0 89.75 89.5 89.25 ... -89.5 -89.75 -90.0
Attributes:
    regrid_method:  bilinear</pre><div class='xr-wrap' hidden><div class='xr-header'><div class='xr-obj-type'>xarray.DataArray</div><div class='xr-array-name'>'tas'</div><ul class='xr-dim-list'><li><span class='xr-has-index'>time</span>: 1980</li><li><span class='xr-has-index'>latitude</span>: 721</li><li><span class='xr-has-index'>longitude</span>: 1440</li></ul></div><ul class='xr-sections'><li class='xr-section-item'><div class='xr-array-wrap'><input id='section-54d77a2a-6ac1-41fb-b9a1-4adb349f1636' class='xr-array-in' type='checkbox' checked><label for='section-54d77a2a-6ac1-41fb-b9a1-4adb349f1636' title='Show/hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-array-preview xr-preview'><span>dask.array&lt;chunksize=(120, 721, 1440), meta=np.ndarray&gt;</span></div><div class='xr-array-data'><table>
<tr>
<td>
<table>
  <thead>
    <tr><td> </td><th> Array </th><th> Chunk </th></tr>
  </thead>
  <tbody>
    <tr><th> Bytes </th><td> 16.45 GB </td> <td> 996.71 MB </td></tr>
    <tr><th> Shape </th><td> (1980, 721, 1440) </td> <td> (120, 721, 1440) </td></tr>
    <tr><th> Count </th><td> 69 Tasks </td><td> 17 Chunks </td></tr>
    <tr><th> Type </th><td> float64 </td><td> numpy.ndarray </td></tr>
  </tbody>
</table>
</td>
<td>
<svg width="217" height="164" style="stroke:rgb(0,0,0);stroke-width:1" >

  <!-- Horizontal lines -->
  <line x1="10" y1="0" x2="80" y2="70" style="stroke-width:2" />
  <line x1="10" y1="44" x2="80" y2="114" style="stroke-width:2" />

  <!-- Vertical lines -->
  <line x1="10" y1="0" x2="10" y2="44" style="stroke-width:2" />
  <line x1="14" y1="4" x2="14" y2="48" />
  <line x1="18" y1="8" x2="18" y2="52" />
  <line x1="22" y1="12" x2="22" y2="56" />
  <line x1="27" y1="17" x2="27" y2="61" />
  <line x1="31" y1="21" x2="31" y2="65" />
  <line x1="35" y1="25" x2="35" y2="69" />
  <line x1="39" y1="29" x2="39" y2="74" />
  <line x1="44" y1="34" x2="44" y2="78" />
  <line x1="48" y1="38" x2="48" y2="82" />
  <line x1="52" y1="42" x2="52" y2="86" />
  <line x1="57" y1="47" x2="57" y2="91" />
  <line x1="61" y1="51" x2="61" y2="95" />
  <line x1="65" y1="55" x2="65" y2="99" />
  <line x1="69" y1="59" x2="69" y2="104" />
  <line x1="74" y1="64" x2="74" y2="108" />
  <line x1="78" y1="68" x2="78" y2="112" />
  <line x1="80" y1="70" x2="80" y2="114" style="stroke-width:2" />

  <!-- Colored Rectangle -->
  <polygon points="10.0,0.0 80.58823529411765,70.58823529411765 80.58823529411765,114.74242739175796 10.0,44.1541920976403" style="fill:#ECB172A0;stroke-width:0"/>

  <!-- Horizontal lines -->
  <line x1="10" y1="0" x2="97" y2="0" style="stroke-width:2" />
  <line x1="14" y1="4" x2="101" y2="4" />
  <line x1="18" y1="8" x2="105" y2="8" />
  <line x1="22" y1="12" x2="110" y2="12" />
  <line x1="27" y1="17" x2="114" y2="17" />
  <line x1="31" y1="21" x2="118" y2="21" />
  <line x1="35" y1="25" x2="122" y2="25" />
  <line x1="39" y1="29" x2="127" y2="29" />
  <line x1="44" y1="34" x2="131" y2="34" />
  <line x1="48" y1="38" x2="135" y2="38" />
  <line x1="52" y1="42" x2="140" y2="42" />
  <line x1="57" y1="47" x2="144" y2="47" />
  <line x1="61" y1="51" x2="148" y2="51" />
  <line x1="65" y1="55" x2="152" y2="55" />
  <line x1="69" y1="59" x2="157" y2="59" />
  <line x1="74" y1="64" x2="161" y2="64" />
  <line x1="78" y1="68" x2="165" y2="68" />
  <line x1="80" y1="70" x2="167" y2="70" style="stroke-width:2" />

  <!-- Vertical lines -->
  <line x1="10" y1="0" x2="80" y2="70" style="stroke-width:2" />
  <line x1="97" y1="0" x2="167" y2="70" style="stroke-width:2" />

  <!-- Colored Rectangle -->
  <polygon points="10.0,0.0 97.27272727272727,0.0 167.86096256684493,70.58823529411765 80.58823529411765,70.58823529411765" style="fill:#ECB172A0;stroke-width:0"/>

  <!-- Horizontal lines -->
  <line x1="80" y1="70" x2="167" y2="70" style="stroke-width:2" />
  <line x1="80" y1="114" x2="167" y2="114" style="stroke-width:2" />

  <!-- Vertical lines -->
  <line x1="80" y1="70" x2="80" y2="114" style="stroke-width:2" />
  <line x1="167" y1="70" x2="167" y2="114" style="stroke-width:2" />

  <!-- Colored Rectangle -->
  <polygon points="80.58823529411765,70.58823529411765 167.86096256684493,70.58823529411765 167.86096256684493,114.74242739175796 80.58823529411765,114.74242739175796" style="fill:#ECB172A0;stroke-width:0"/>

  <!-- Text -->
  <text x="124.224599" y="134.742427" font-size="1.0rem" font-weight="100" text-anchor="middle" >1440</text>
  <text x="187.860963" y="92.665331" font-size="1.0rem" font-weight="100" text-anchor="middle" transform="rotate(-90,187.860963,92.665331)">721</text>
  <text x="35.294118" y="99.448310" font-size="1.0rem" font-weight="100" text-anchor="middle" transform="rotate(45,35.294118,99.448310)">1980</text>
</svg>
</td>
</tr>
</table></div></div></li><li class='xr-section-item'><input id='section-22e54e80-e29a-495c-be69-11b668454e0f' class='xr-section-summary-in' type='checkbox'  checked><label for='section-22e54e80-e29a-495c-be69-11b668454e0f' class='xr-section-summary' >Coordinates: <span>(4)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>time</span></div><div class='xr-var-dims'>(time)</div><div class='xr-var-dtype'>datetime64[ns]</div><div class='xr-var-preview xr-preview'>1850-01-16T12:00:00 ... 2014-12-...</div><input id='attrs-014cf468-539f-44ed-bb53-9594d6ceacee' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-014cf468-539f-44ed-bb53-9594d6ceacee' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-a607ad11-b02c-4c38-96e5-c84ddbeb1648' class='xr-var-data-in' type='checkbox'><label for='data-a607ad11-b02c-4c38-96e5-c84ddbeb1648' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'><dt><span>bounds :</span></dt><dd>time_bnds</dd><dt><span>axis :</span></dt><dd>T</dd><dt><span>long_name :</span></dt><dd>time</dd><dt><span>standard_name :</span></dt><dd>time</dd></dl></div><div class='xr-var-data'><pre>array([&#x27;1850-01-16T12:00:00.000000000&#x27;, &#x27;1850-02-15T00:00:00.000000000&#x27;,
       &#x27;1850-03-16T12:00:00.000000000&#x27;, ..., &#x27;2014-10-16T12:00:00.000000000&#x27;,
       &#x27;2014-11-16T00:00:00.000000000&#x27;, &#x27;2014-12-16T12:00:00.000000000&#x27;],
      dtype=&#x27;datetime64[ns]&#x27;)</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>height</span></div><div class='xr-var-dims'>()</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>...</div><input id='attrs-58e385ae-4249-48e8-9643-d568e8042d57' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-58e385ae-4249-48e8-9643-d568e8042d57' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-2900d58f-f8f1-4cac-90b9-3820397fe637' class='xr-var-data-in' type='checkbox'><label for='data-2900d58f-f8f1-4cac-90b9-3820397fe637' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'><dt><span>units :</span></dt><dd>m</dd><dt><span>axis :</span></dt><dd>Z</dd><dt><span>positive :</span></dt><dd>up</dd><dt><span>long_name :</span></dt><dd>height</dd><dt><span>standard_name :</span></dt><dd>height</dd></dl></div><div class='xr-var-data'><pre>array(2.)</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>longitude</span></div><div class='xr-var-dims'>(longitude)</div><div class='xr-var-dtype'>float32</div><div class='xr-var-preview xr-preview'>-180.0 -179.8 ... 179.5 179.8</div><input id='attrs-d88ffcba-65a4-4f4f-ba42-d58b180a5334' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-d88ffcba-65a4-4f4f-ba42-d58b180a5334' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-c79b7385-a54b-4e8c-8671-61772073836f' class='xr-var-data-in' type='checkbox'><label for='data-c79b7385-a54b-4e8c-8671-61772073836f' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'><dt><span>units :</span></dt><dd>degrees_east</dd><dt><span>long_name :</span></dt><dd>longitude</dd></dl></div><div class='xr-var-data'><pre>array([-180.  , -179.75, -179.5 , ...,  179.25,  179.5 ,  179.75],
      dtype=float32)</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>latitude</span></div><div class='xr-var-dims'>(latitude)</div><div class='xr-var-dtype'>float32</div><div class='xr-var-preview xr-preview'>90.0 89.75 89.5 ... -89.75 -90.0</div><input id='attrs-ee46304d-32ee-4bc7-8b64-a4e4009d67c3' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-ee46304d-32ee-4bc7-8b64-a4e4009d67c3' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-2be18f04-206b-4e6d-9122-061715e857af' class='xr-var-data-in' type='checkbox'><label for='data-2be18f04-206b-4e6d-9122-061715e857af' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'><dt><span>units :</span></dt><dd>degrees_north</dd><dt><span>long_name :</span></dt><dd>latitude</dd></dl></div><div class='xr-var-data'><pre>array([ 90.  ,  89.75,  89.5 ,  89.25,  89.  ,  88.75,  88.5 ,  88.25,
        88.  ,  87.75,  87.5 ,  87.25,  87.  ,  86.75,  86.5 ,  86.25,
        86.  ,  85.75,  85.5 ,  85.25,  85.  ,  84.75,  84.5 ,  84.25,
        84.  ,  83.75,  83.5 ,  83.25,  83.  ,  82.75,  82.5 ,  82.25,
        82.  ,  81.75,  81.5 ,  81.25,  81.  ,  80.75,  80.5 ,  80.25,
        80.  ,  79.75,  79.5 ,  79.25,  79.  ,  78.75,  78.5 ,  78.25,
        78.  ,  77.75,  77.5 ,  77.25,  77.  ,  76.75,  76.5 ,  76.25,
        76.  ,  75.75,  75.5 ,  75.25,  75.  ,  74.75,  74.5 ,  74.25,
        74.  ,  73.75,  73.5 ,  73.25,  73.  ,  72.75,  72.5 ,  72.25,
        72.  ,  71.75,  71.5 ,  71.25,  71.  ,  70.75,  70.5 ,  70.25,
        70.  ,  69.75,  69.5 ,  69.25,  69.  ,  68.75,  68.5 ,  68.25,
        68.  ,  67.75,  67.5 ,  67.25,  67.  ,  66.75,  66.5 ,  66.25,
        66.  ,  65.75,  65.5 ,  65.25,  65.  ,  64.75,  64.5 ,  64.25,
        64.  ,  63.75,  63.5 ,  63.25,  63.  ,  62.75,  62.5 ,  62.25,
        62.  ,  61.75,  61.5 ,  61.25,  61.  ,  60.75,  60.5 ,  60.25,
        60.  ,  59.75,  59.5 ,  59.25,  59.  ,  58.75,  58.5 ,  58.25,
        58.  ,  57.75,  57.5 ,  57.25,  57.  ,  56.75,  56.5 ,  56.25,
        56.  ,  55.75,  55.5 ,  55.25,  55.  ,  54.75,  54.5 ,  54.25,
        54.  ,  53.75,  53.5 ,  53.25,  53.  ,  52.75,  52.5 ,  52.25,
        52.  ,  51.75,  51.5 ,  51.25,  51.  ,  50.75,  50.5 ,  50.25,
...
       -52.  , -52.25, -52.5 , -52.75, -53.  , -53.25, -53.5 , -53.75,
       -54.  , -54.25, -54.5 , -54.75, -55.  , -55.25, -55.5 , -55.75,
       -56.  , -56.25, -56.5 , -56.75, -57.  , -57.25, -57.5 , -57.75,
       -58.  , -58.25, -58.5 , -58.75, -59.  , -59.25, -59.5 , -59.75,
       -60.  , -60.25, -60.5 , -60.75, -61.  , -61.25, -61.5 , -61.75,
       -62.  , -62.25, -62.5 , -62.75, -63.  , -63.25, -63.5 , -63.75,
       -64.  , -64.25, -64.5 , -64.75, -65.  , -65.25, -65.5 , -65.75,
       -66.  , -66.25, -66.5 , -66.75, -67.  , -67.25, -67.5 , -67.75,
       -68.  , -68.25, -68.5 , -68.75, -69.  , -69.25, -69.5 , -69.75,
       -70.  , -70.25, -70.5 , -70.75, -71.  , -71.25, -71.5 , -71.75,
       -72.  , -72.25, -72.5 , -72.75, -73.  , -73.25, -73.5 , -73.75,
       -74.  , -74.25, -74.5 , -74.75, -75.  , -75.25, -75.5 , -75.75,
       -76.  , -76.25, -76.5 , -76.75, -77.  , -77.25, -77.5 , -77.75,
       -78.  , -78.25, -78.5 , -78.75, -79.  , -79.25, -79.5 , -79.75,
       -80.  , -80.25, -80.5 , -80.75, -81.  , -81.25, -81.5 , -81.75,
       -82.  , -82.25, -82.5 , -82.75, -83.  , -83.25, -83.5 , -83.75,
       -84.  , -84.25, -84.5 , -84.75, -85.  , -85.25, -85.5 , -85.75,
       -86.  , -86.25, -86.5 , -86.75, -87.  , -87.25, -87.5 , -87.75,
       -88.  , -88.25, -88.5 , -88.75, -89.  , -89.25, -89.5 , -89.75,
       -90.  ], dtype=float32)</pre></div></li></ul></div></li><li class='xr-section-item'><input id='section-778e4342-326d-4e9c-a975-9dbd4c5be688' class='xr-section-summary-in' type='checkbox'  checked><label for='section-778e4342-326d-4e9c-a975-9dbd4c5be688' class='xr-section-summary' >Attributes: <span>(1)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><dl class='xr-attrs'><dt><span>regrid_method :</span></dt><dd>bilinear</dd></dl></div></li></ul></div></div></div></div>
</div>
<p>We can now compare the two datasets. Here I’ve done the regrid from the coarse ACCESS-CM2 grid to the fine ERA5 grid. It looks nice, but most of the fine detail is just coming from the ERA5 data, since it uses a 0.25 degree grid. When analysing the data you wouldn’t want to look at scales any smaller than the coarse grid - about 1.5 degrees in this case.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">delta_era5_grid</span> <span class="o">=</span> <span class="n">ds_era5</span><span class="o">.</span><span class="n">t2m</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="s1">&#39;2010-05-16T00:00&#39;</span><span class="p">)</span> <span class="o">-</span> <span class="n">tas</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="s1">&#39;2010-05-16&#39;</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;nearest&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>
<span class="n">delta_era5_grid</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">vmax</span><span class="o">=</span><span class="mi">25</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.collections.QuadMesh at 0x7f2c92c98760&gt;
</pre></div>
</div>
<img alt="../_images/regridding_14_1.png" src="../_images/regridding_14_1.png" />
</div>
</div>
<p>Regridding in the other direction works exactly the same way. The result is consistent with the high resolution grid, although a bit blockier because of the coarser resolution. The useful information is the same in both directions, going from fine to coarse just makes this more explicit.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">regrid_era5_to_cmip</span> <span class="o">=</span> <span class="n">xesmf</span><span class="o">.</span><span class="n">Regridder</span><span class="p">(</span><span class="n">ds_era5</span><span class="p">,</span> <span class="n">ds_cmip</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;bilinear&#39;</span><span class="p">,</span> <span class="n">periodic</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">t2m</span> <span class="o">=</span> <span class="n">regrid_era5_to_cmip</span><span class="p">(</span><span class="n">ds_era5</span><span class="o">.</span><span class="n">t2m</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/g/data3/hh5/public/apps/miniconda3/envs/analysis3-21.01/lib/python3.8/site-packages/xesmf/frontend.py:464: FutureWarning: ``output_sizes`` should be given in the ``dask_gufunc_kwargs`` parameter. It will be removed as direct parameter in a future version.
  dr_out = xr.apply_ufunc(
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">delta_cmip5_grid</span> <span class="o">=</span> <span class="n">t2m</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="s1">&#39;2010-05-16T00:00&#39;</span><span class="p">)</span> <span class="o">-</span> <span class="n">ds_cmip</span><span class="o">.</span><span class="n">tas</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="s1">&#39;2010-05-16&#39;</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;nearest&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>
<span class="n">delta_cmip5_grid</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">vmax</span><span class="o">=</span><span class="mi">25</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.collections.QuadMesh at 0x7f2c7ac96490&gt;
</pre></div>
</div>
<img alt="../_images/regridding_18_1.png" src="../_images/regridding_18_1.png" />
</div>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "conda-env-analysis3-py"
        },
        kernelOptions: {
            kernelName: "conda-env-analysis3-py",
            path: "./case-studies"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'conda-env-analysis3-py'</script>

              </div>
              
        
        <div class='prev-next-bottom'>
            
    <a class='left-prev' id="prev-link" href="climatology_multivar.html" title="previous page">Monthly Climatology of Many Variables</a>

        </div>
        
        </div>
    </div>
    <footer class="footer mt-5 mt-md-0">
    <div class="container">
      <p>
        
          By CLEX CMS<br/>
        
            &copy; Copyright 2020.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>
  
  <script src="../_static/js/index.1c5a1a01449ed65a7b51.js"></script>

  
  </body>
</html>